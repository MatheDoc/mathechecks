<div class="diagramm-row">
  <div class="eingabe-box">

    <div class="eingabe-zeile">
      <label>n =</label>
      <input type="range" id="nSlider2" min="1" max="50" value="10">
      <input type="text" id="nInput2" value="10" style="width:4em">
    </div>

    <div class="eingabe-zeile">
      <label>p =</label>
      <input type="range" id="pSlider2" min="0" max="1" value="0.5" step="0.01">
      <input type="text" id="pInput2" value="0.5" style="width:4em">
    </div>

    <div class="eingabe-zeile">
      <label>a =</label>
      <input type="range" id="aSlider" min="0" max="10" value="3">
      <input type="text" id="aInput" value="3" style="width:4em">
    </div>

    <div class="eingabe-zeile">
      <label>b =</label>
      <input type="range" id="bSlider" min="0" max="10" value="7">
      <input type="text" id="bInput" value="7" style="width:4em">
    </div>

    <div class="eingabe-zeile">
      <label>
        <input type="checkbox" id="autoY" checked>
        y-Achse automatisch skalieren
      </label>
    </div>

    <div class="eingabe-zeile" style="justify-content:center">
      <span id="intervallWert"></span>
    </div>

  </div>

  <div id="plotEinzeln" class="diagramm"></div>
  <div id="plotKumuliert" class="diagramm"></div>
</div>

<script>
  /* ------------------ Parser für Dezimalzahlen und Brüche ------------------ */
  function parseFraction(input) {
    input = input.replace(",", ".").replace(/\s+/g, "");

    if (input.includes("/")) {
      const parts = input.split("/");
      if (parts.length !== 2) return null;

      const num = parseFloat(parts[0]);
      const den = parseFloat(parts[1]);
      if (isNaN(num) || isNaN(den) || den === 0) return null;

      return num / den;
    }

    const value = parseFloat(input);
    return isNaN(value) ? null : value;
  }

  /* ------------------ Sliderbereiche von a,b an n anpassen ------------------ */
  function updateSliderRanges() {
    const n = parseInt(document.getElementById("nSlider2").value);

    const aInput = document.getElementById("aInput");
    const bInput = document.getElementById("bInput");
    const aSlider = document.getElementById("aSlider");
    const bSlider = document.getElementById("bSlider");

    aSlider.max = n;
    bSlider.max = n;

    const aRaw = parseFraction(aInput.value);
    const bRaw = parseFraction(bInput.value);

    if (aRaw !== null && Math.ceil(aRaw) > n) {
      aInput.value = n;
      aSlider.value = n;
    }

    if (bRaw !== null && Math.floor(bRaw) > n) {
      bInput.value = n;
      bSlider.value = n;
    }
  }


  /* ------------------ Hauptaktualisierung ------------------ */
  function updateFromInputs() {
    const n = parseInt(document.getElementById("nSlider2").value);
    const p = parseFloat(document.getElementById("pSlider2").value);

    const aRaw = parseFraction(document.getElementById("aInput").value);
    const bRaw = parseFraction(document.getElementById("bInput").value);

    if (aRaw === null || bRaw === null) return;

    const a = Math.ceil(aRaw);
    const b = Math.floor(bRaw);

    const autoY = document.getElementById("autoY").checked;

    zeichneHistogrammEinzeln(
      n, p, a, b,
      "plotEinzeln",
      "Einzelwahrscheinlichkeiten",
      autoY,
      "intervallWert"
    );

    zeichneHistogrammKumuliert(
      n, p, a, b,
      "plotKumuliert",
      "Kumulierte Wahrscheinlichkeiten"
    );
  }

  /* ------------------ n: Ganzzahlig, Anzeige = Rechnung ------------------ */
  (function () {
    const slider = document.getElementById("nSlider2");
    const input = document.getElementById("nInput2");

    slider.addEventListener("input", () => {
      input.value = slider.value;
      updateSliderRanges();
      updateFromInputs();
    });

    input.addEventListener("input", () => {
      const parsed = parseFraction(input.value);
      if (parsed === null) return;

      const value = Math.round(parsed);
      slider.value = value;
      input.value = value;

      updateSliderRanges();
      updateFromInputs();
    });
  })();

  /* ------------------ a: Anzeige beliebig, Rechnung = aufgerundet ------------------ */
  (function () {
    const slider = document.getElementById("aSlider");
    const input = document.getElementById("aInput");

    slider.addEventListener("input", () => {
      input.value = slider.value;
      updateFromInputs();
    });

    input.addEventListener("input", () => {
      const parsed = parseFraction(input.value);
      if (parsed === null) return;

      const value = Math.ceil(parsed);
      slider.value = value;
      updateFromInputs();
    });
  })();

  /* ------------------ b: Anzeige beliebig, Rechnung = abgerundet ------------------ */
  (function () {
    const slider = document.getElementById("bSlider");
    const input = document.getElementById("bInput");

    slider.addEventListener("input", () => {
      input.value = slider.value;
      updateFromInputs();
    });

    input.addEventListener("input", () => {
      const parsed = parseFraction(input.value);
      if (parsed === null) return;

      const value = Math.floor(parsed);
      slider.value = value;
      updateFromInputs();
    });
  })();

  /* ------------------ p: Brüche erlaubt ------------------ */
  (function () {
    const slider = document.getElementById("pSlider2");
    const input = document.getElementById("pInput2");

    slider.addEventListener("input", () => {
      input.value = slider.value;
      updateFromInputs();
    });

    input.addEventListener("input", () => {
      const parsed = parseFraction(input.value);
      if (parsed === null || parsed < 0 || parsed > 1) return;

      slider.value = parsed.toFixed(2);
      updateFromInputs();
    });
  })();

  /* ------------------ Checkbox ------------------ */
  document.getElementById("autoY")
    .addEventListener("change", updateFromInputs);

  /* ------------------ Initialisierung ------------------ */
  updateSliderRanges();
  updateFromInputs();
</script>