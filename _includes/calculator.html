<div id="calculator-overlay" class="calculator-overlay" aria-hidden="true">
    <div class="calculator-container">
        <div class="calculator">
            <div class="display">
                <div class="result-row">
                    <div class="result-display" id="resultDisplay">0</div>
                    <button class="copy-result" id="copyResultButton" onclick="copyResult()"
                        aria-label="Ergebnis kopieren" title="Ergebnis kopieren">
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path
                                d="M16 1H6c-1.1 0-2 .9-2 2v12h2V3h10V1zm3 4H10c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h9c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H10V7h9v14z" />
                        </svg>
                        <span class="copy-check" aria-hidden="true">✓</span>
                    </button>
                </div>
            </div>

            <div class="main-input">
                <input type="text" id="mainInput" name="calc-main-input" inputmode="decimal" autocomplete="off"
                    autocapitalize="off" spellcheck="false" placeholder="Eingabe">
            </div>

            <div class="buttons">
                <!-- Reihe 1 -->
                <button class="top-key" onclick=""></button>
                <button class="top-key" onclick="openLGSPopup()">LGS</button>
                <button class="top-key" onclick="openBinPopup()">BINOM</button>
                <button class="clear" onclick="clearAll()">C</button>

                <!-- Reihe 2 -->
                <button class="top-key" type="button" onclick="openTriPopup()">FUNC</button>
                <button class="top-key" onclick="appendOperator('^')">^</button>
                <button class="top-key" type="button" onclick="appendAutoParen()">()</button>
                <button class="clear" onclick="backspace()">⌫</button>

                <!-- Reihe 3 -->
                <button type="button" onclick="openConstPopup()">CONST</button>
                <button class="top-key" onclick="appendNumber('x')">x</button>
                <button class="top-key" onclick="appendOperator('=')">=</button>
                <button class="operator" onclick="appendOperator('/')">÷</button>

                <!-- Reihe 4-7 -->
                <button onclick="appendNumber('7')">7</button>
                <button onclick="appendNumber('8')">8</button>
                <button onclick="appendNumber('9')">9</button>
                <button class="operator" onclick="appendOperator('*')">×</button>

                <button onclick="appendNumber('4')">4</button>
                <button onclick="appendNumber('5')">5</button>
                <button onclick="appendNumber('6')">6</button>
                <button class="operator" onclick="appendOperator('-')">−</button>

                <button onclick="appendNumber('1')">1</button>
                <button onclick="appendNumber('2')">2</button>
                <button onclick="appendNumber('3')">3</button>
                <button class="operator" onclick="appendOperator('+')">+</button>

                <button class="top-key" onclick="insertAns()">Ans</button>
                <button onclick="appendNumber('0')">0</button>
                <button onclick="appendNumber('.')">,</button>
                <button class="equals" onclick="handleExecute()">EXE</button>
            </div>
        </div>

        <!-- LGS Popup -->
        <div class="popup-overlay" id="lgsOverlay"></div>
        <div class="popup" id="lgsPopup">
            <div class="popup-drag-handle" id="lgsPopupDrag">
                <button class="popup-close" onclick="closeLGSPopup()" aria-label="Schließen">×</button>
            </div>
            <div class="popup-content">
                <div class="lgs-controls">
                    <button onclick="addLGSVariable()">+ Var.</button>
                    <button class="remove" onclick="removeLGSVariable()">- Var.</button>
                    <button onclick="addLGSEquation()">+ Gl.</button>
                    <button class="remove" onclick="removeLGSEquation()">- Gl.</button>
                </div>
                <div id="lgsMatrix"></div>
            </div>
            <div class="popup-actions">
                <button class="btn-secondary" onclick="closeLGSPopup()">Abbrechen</button>
                <button class="btn-primary" onclick="confirmLGS()">Bestätigen</button>
            </div>
        </div>

        <!-- BIN Popup -->
        <div class="popup-overlay" id="binOverlay"></div>
        <div class="popup" id="binPopup">
            <div class="popup-drag-handle" id="binPopupDrag">
                <button class="popup-close" onclick="closeBinPopup()" aria-label="Schließen">×</button>
            </div>
            <div class="popup-content">
                <div class="binom-row">
                    <div class="binom-field">
                        <div class="binom-input">
                            <input type="text" id="binomA" name="calc-binom-a" inputmode="decimal" autocomplete="off"
                                autocapitalize="off" spellcheck="false" placeholder="a">
                            <div class="binom-stepper" aria-hidden="true">
                                <button type="button" class="binom-step" data-target="binomA" data-step="1"
                                    aria-label="a erhöhen" tabindex="-1">▲</button>
                                <button type="button" class="binom-step" data-target="binomA" data-step="-1"
                                    aria-label="a verringern" tabindex="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div class="binom-field">
                        <div class="binom-input">
                            <input type="text" id="binomB" name="calc-binom-b" inputmode="decimal" autocomplete="off"
                                autocapitalize="off" spellcheck="false" placeholder="b">
                            <div class="binom-stepper" aria-hidden="true">
                                <button type="button" class="binom-step" data-target="binomB" data-step="1"
                                    aria-label="b erhöhen" tabindex="-1">▲</button>
                                <button type="button" class="binom-step" data-target="binomB" data-step="-1"
                                    aria-label="b verringern" tabindex="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div class="binom-field">
                        <div class="binom-input">
                            <input type="text" id="binomN" name="calc-binom-n" inputmode="decimal" autocomplete="off"
                                autocapitalize="off" spellcheck="false" placeholder="n">
                            <div class="binom-stepper" aria-hidden="true">
                                <button type="button" class="binom-step" data-target="binomN" data-step="1"
                                    aria-label="n erhöhen" tabindex="-1">▲</button>
                                <button type="button" class="binom-step" data-target="binomN" data-step="-1"
                                    aria-label="n verringern" tabindex="-1">▼</button>
                            </div>
                        </div>
                    </div>
                    <div class="binom-field">
                        <div class="binom-input">
                            <input type="text" id="binomP" name="calc-binom-p" inputmode="decimal" autocomplete="off"
                                autocapitalize="off" spellcheck="false" placeholder="p">
                            <div class="binom-stepper" aria-hidden="true">
                                <button type="button" class="binom-step" data-target="binomP" data-step="0.01"
                                    aria-label="p erhöhen" tabindex="-1">▲</button>
                                <button type="button" class="binom-step" data-target="binomP" data-step="-0.01"
                                    aria-label="p verringern" tabindex="-1">▼</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 6px; padding: 5px; background: #f0f4f8; border-radius: 4px; font-size: 13px;">
                    <strong>P(a &le; X &le; b):</strong> <span id="binomLiveResult">-</span>
                </div>
            </div>
            <div class="popup-actions">
                <button class="btn-secondary" onclick="closeBinPopup()">Abbrechen</button>
                <button class="btn-primary" onclick="confirmBin()">Bestätigen</button>
            </div>
        </div>

        <!-- CONST Popup -->
        <div class="popup-overlay" id="constOverlay"></div>
        <div class="popup" id="constPopup">
            <div class="popup-drag-handle" id="constPopupDrag">
                <button class="popup-close" onclick="closeConstPopup()" aria-label="Schließen">×</button>
            </div>
            <div class="popup-content">
                <div class="const-menu" role="menu">
                    <button type="button" onclick="appendNumber('π'); closeConstPopup()">π</button>
                    <button type="button" onclick="appendNumber('e'); closeConstPopup()">e</button>
                </div>
            </div>
        </div>

        <!-- TRI/LOG Popup -->
        <div class="popup-overlay" id="triOverlay"></div>
        <div class="popup" id="triPopup">
            <div class="popup-drag-handle" id="triPopupDrag">
                <button class="popup-close" onclick="closeTriPopup()" aria-label="Schließen">×</button>
            </div>
            <div class="popup-content">
                <div class="tri-menu" role="menu">
                    <button type="button" onclick="appendRootTemplate(); closeTriPopup()">x√y</button>
                    <button type="button" onclick="appendFunction('sin('); closeTriPopup()">sin</button>
                    <button type="button" onclick="appendFunction('cos('); closeTriPopup()">cos</button>
                    <button type="button" onclick="appendFunction('tan('); closeTriPopup()">tan</button>
                    <button type="button" onclick="appendLogTemplate(); closeTriPopup()">log_()()</button>
                    <button type="button" onclick="appendFunction('ln('); closeTriPopup()">ln</button>
                </div>
            </div>
        </div>
    </div>
</div>